<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Todo</title>

<style>
body{margin:0;background:#000;color:#fff;font-family:sans-serif}
.app{max-width:480px;margin:auto;padding:16px;background:#121212}
.week{display:flex;gap:4px;margin-bottom:10px}
.day{flex:1;background:#1e1e1e;padding:6px 0;border-radius:10px;text-align:center;font-size:12px}
.day.done{background:#1e88e5}
.card{background:#1e1e1e;border-radius:16px;padding:14px}

input{flex:1;padding:12px;border:none;border-radius:10px;background:#2a2a2a;color:#fff}
button{background:#1877f2;border:none;color:white;border-radius:10px;padding:12px}

ul{list-style:none;padding:0;margin:0}
li{
background:#2a2a2a;
margin-bottom:8px;
padding:10px;
border-radius:12px;
display:flex;
justify-content:space-between;
align-items:center;
cursor:pointer
}

.checkBox{
width:20px;height:20px;
border:2px solid #555;
border-radius:6px;
display:flex;
align-items:center;
justify-content:center;
color:#4caf50;
font-weight:bold;
}

.checked{
border-color:#4caf50;
background:#123f1a;
}

.actions{display:flex;align-items:center;gap:6px}
.del-btn{background:transparent;color:#ff5f5f;font-size:16px;border:none}

.modal{
position:fixed;inset:0;background:rgba(0,0,0,.8);
display:none;justify-content:center;align-items:center;z-index:999
}
.modalBox{
background:#1e1e1e;padding:20px;border-radius:16px;width:80%
}
</style>
</head>

<body>
<div class="app">

<div class="week" id="weekBar"></div>

<div class="card">
  <div style="display:flex;gap:8px;margin-bottom:12px">
    <input id="todoInput" placeholder="할 일 입력">
    <button id="addBtn">+</button>
  </div>
  <ul id="todoList"></ul>
</div>

</div>

<div class="modal" id="modal">
  <div class="modalBox">
    <h3 id="modalTitle"></h3>
    <ul id="modalList"></ul>
    <button onclick="closeModal()">닫기</button>
  </div>
</div>

<script>
const days=["월","화","수","목","금","토","일"];

const listEl=document.getElementById("todoList");
const inputEl=document.getElementById("todoInput");
const weekBar=document.getElementById("weekBar");

let todos=JSON.parse(localStorage.getItem("todos")||"[]");
let history=JSON.parse(localStorage.getItem("history")||"{}");
let dayTasks=JSON.parse(localStorage.getItem("dayTasks")||"{}");

function todayKey(){
 let d=new Date();
 if(d.getHours()<5)d.setDate(d.getDate()-1);
 return d.toISOString().split("T")[0];
}

function monday(){
 let d=new Date();
 if(d.getHours()<5)d.setDate(d.getDate()-1);
 let day=d.getDay(); let diff=(day===0?-6:1)-day;
 d.setDate(d.getDate()+diff); return d;
}

function save(){
 localStorage.setItem("todos",JSON.stringify(todos));
 localStorage.setItem("history",JSON.stringify(history));
 localStorage.setItem("dayTasks",JSON.stringify(dayTasks));
}

function updateHistory(){
 const k=todayKey();
 history[k]={done:todos.filter(t=>t.done).length,total:todos.length};
 dayTasks[k]=todos.map(t=>({...t}));
 save();
}

function renderWeek(){
 weekBar.innerHTML="";
 const m=monday();
 for(let i=0;i<7;i++){
  let d=new Date(m);d.setDate(m.getDate()+i);
  let k=d.toISOString().split("T")[0];
  let data=history[k]||{done:0,total:0};

  let box=document.createElement("div");
  box.className="day";
  box.innerHTML=`${days[i]}<br>${data.done}/${data.total}`;
  if(data.done===data.total && data.total>0)box.classList.add("done");
  weekBar.appendChild(box);
 }
}

function renderTodos(){
 listEl.innerHTML="";
 todos.forEach((t,i)=>{
  const li=document.createElement("li");

  const txt=document.createElement("span");
  txt.textContent=t.text;

  const actions=document.createElement("div");
  actions.className="actions";

  const box=document.createElement("div");
  box.className="checkBox";
  if(t.done){
    box.classList.add("checked");
    box.textContent="✓";
  }

  const bar=document.createElement("span");
  bar.textContent="|";

  const del=document.createElement("button");
  del.textContent="❌";
  del.className="del-btn";

  li.onclick=()=>{
   todos[i].done=!todos[i].done;
   updateHistory();renderTodos();renderWeek();
  }

  del.onclick=(e)=>{
   e.stopPropagation();
   if(!confirm("삭제하시겠습니까?"))return;
   todos.splice(i,1);
   updateHistory();renderTodos();renderWeek();
  }

  actions.append(box,bar,del);
  li.append(txt,actions);
  listEl.appendChild(li);
 })
}

function addTodo(){
 const t=inputEl.value.trim();
 if(!t)return;
 todos.push({text:t,done:false});
 inputEl.value="";
 updateHistory();renderTodos();renderWeek();
}

document.getElementById("addBtn").onclick=addTodo;

updateHistory();
renderTodos();
renderWeek();
</script>
</body>
</html>
